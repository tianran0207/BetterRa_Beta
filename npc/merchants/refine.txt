//===== rAthena Script ======================================= 
//= Refining NPCs
//===== By: ==================================================
//= Syrus22 (1.1) dafide18 (1.4) Skotlex (1.5)
//===== Current Version: =====================================
//= 3.4
//===== Compatible With: =====================================
//= rAthena Project
//===== Description: =========================================
//= Refining NPCs and Metal Salesmen.
//===== Additional Comments: =================================
//= 3.0 Updated several NPC names and locations. [Xantara]
//=     Added WoE map Refiners.
//= 3.1 Added the new refinement & Ore creation NPC's for +11 and above Refinement. [Masao]
//= 3.2 Moved some scripts to Renewal file, other minor changes. [Euphy]
//= 3.2a Added 'disable_items' command. [Euphy]
//= 3.3 Some official script updates. [Euphy]
//= 3.4 Added VIP features. [Euphy]
//============================================================

// Christopher: Geffen Blacksmith
//============================================================
geffen_in,110,172,0	script	îãìÒÕQóc¡@¡@²Ù#1	63,{
	mes "[îãìÒÕQóc¡@¡@²ÙÃf";
	mes "ÒF¡@¡@, îØÕoÃrôe¶!";
	mes "¼c¡@¡@¡@¡@ÑJîãìÖéFóc¡@¡@²Ù¡@İµîÑ¡@áâ.";
	next;
	mes "[îãìÒÕQóc¡@¡@²ÙÃf";
	mes "âYø¬éFíi¡@ÔøñS€æÙóîã¥Rò«ºö¼@¡@¡@£¸ÕÚ¡@¡@İµ.";
	mes "Âí£ºÚV·åË¼ÓM¯K³úé¡?";
	next;
	switch(select("ñi¡@¡@·åË¼«ıìH¨Ş¡@:ñi¡@¡@·åË¼«ıºö¼@¡@ôğ¡@éL¡@:ñi¡@¡@·åË¼«ı¡@¡@¡@:ñi¡@¡@·åË¼«ıîâ¦·ßcîÔ¡@¡@:îíÑïÖÇ")) {
	case 1:
		mes "[îãìÒÕQóc¡@¡@²ÙÃf";
		mes "¡@£·¡@îâ¦·ßcÎg¡t¡@ôğäõİµÅI§,";
		mes "ër¡@¡@óq¡@ÖÄîê¡@¡üôğäõìÆÅô¡@ÖÄ¾ü½.";
		mes "®şá¬Á^Âí£¶¡@æ¢¡@¡@¡@¡@¡@,";
		mes "Âï³ú¡@¯Æ¡@ÕÚ¡@¡@¡@ÒW¾WÒ~®şÔí®òÂïØ¤§j.";
		mes "Âí£¶¡@ÒW¡@¬»¡@¡@ï»®fÅGÕÚºıÉáŞöîÏ¡@Øvè§¡@á{ÁíØ¨€‚ôğ„.";
		next;
		switch(select("ìH¨Ş¡@ - 30,000z:²ØÏ²¡@¡@¡@¡@ìH¨Ş¡@ - 120,000z:ºdäõìÆìH¨Ş¡@ - 300,000z:óa§ø¡@ôğäõİµÅI§:îíÑïÖÇ")) {
		case 1:
			if (Zeny < 30000) {
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ñiİt¡@¾Èİäğo®ş¡@ÀôÃñ·Î¤ZºıÉáåÎÃì€äßXôğ¡@Â²ëæ¡@¡@®şÂEğo¯KØ©ßXôğ¡@ÀôìNåxÓQñS€ä¤¬¯K¡@ÓGîãËµ¡@ÂzÔíÓF";
				close;
			}
			getitem 986,1; // Anvil
			Zeny = Zeny-30000;
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "ÒF¡@€‰ñV¡@ÕÚâY¡@¡@¿¨á¦åÎ«»¡@½r²Z«±¡@ôğ¡@¡@¿¨.";
			close;
		case 2:
			if (Zeny < 120000) {
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ñiİt¡@¾Èİäğo®ş¡@ÀôÃñ·Î¤ZºıÉáåÎÃì€äßXôğ¡@Â²ëæ¡@¡@®şÂEğo¯KØ©ßXôğ¡@ÀôìNåxÓQñS€ä¤¬¯K¡@ÓGîãËµ¡@ÂzÔíÓF";
				close;
			}
			getitem 987,1; // Oridecon_Anvil
			Zeny = Zeny-120000;
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "îé¢!öf¡@¡@ÒF¡@åÎ®ş¡@¡@ôe¸ú€‚âY¡@¡@ôe¡@åÎ®ş€ä°yè§³ËÑ®ìHËÃÑiôğäõİµÅI¡@ÓQÒFËf¡@óq¡@¡@?";
			close;
		case 3:
			if (Zeny < 300000) {
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ñiİt¡@¾Èİäğo®ş¡@ÀôÃñ·Î¤ZºıÉáåÎÃì€äßXôğ¡@Â²ëæ¡@¡@®şÂEğo¯KØ©ßXôğ¡@ÀôìNåxÓQñS€ä¤¬¯K¡@ÓGîãËµ¡@ÂzÔíÓF";
				close;
			}
			getitem 988,1; // Golden_Anvil
			Zeny = Zeny-300000;
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "âY¡@¡@®ş¡@åÎ®f¡@ßcôe¡@¡@®ş¡@ÕÚÃì€å¡@ôğ¡@¡@¿¨¡@ÓQ¡@£¹ğo¿¨á«İµÅI¡@ÓQÒFÊD¡@ô\ºÀ¡@ÒW¡@¡@îîÀÁİµîÑÊD¡@";
			close;
		case 4:
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "¾È¡@ÎqÎg‰!";
			mes "ñiİtğo¡@ÉÙ¯fÃì¡@¡@ºdäõìÆìH¨Ş¡@óa§ø¡@ôğäõİµÅI¡@Â².";
			next;
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "ñi¡@¡@ÒZËf¡@®ş¡@ÕÚ'Ringgel'Ãì¡@¡@âYÅÏÏr¾ü¬ÉÕÚìH¨Ş¡@, ÒF¡@åÎôe¡@Ñ{óq¡@¡@®ş¡@Öåæ¢½R€Œ®f².";
			close;
		case 5:
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "ÀáØQõ×Ãì¡@´«ÒF¡@ÚV·å¨ŞÕÚæ¢, ";
			mes "¼c¡@¡@Âí£¶Ô©ºS¡tÔp®ş´.";
			mes "æ¢¾W°ÑÂzæ»";
			close;
		}
	case 2:
		mes "[îãìÒÕQóc¡@¡@²ÙÃf";
		mes "ÒZ¡@¡@ôğäõİµîÑ¡@¡@ôù¸öæí·å¨ŞÙuÒZ¡@¡@ôğäõ¡@îã·¬€‚";
		mes "ÀáØQõ×¡@£¶¡@¡@ÉÙÏ_¿G¡@¡@ìHËÃÑiìHÂE³İ¯K¦ñ¡@îã­·ÕÚæ¢¡@ÓQ";
		mes "Âí£µ¡@ôe´ã¡@ÒW¡@Î]®şÅF¡@Áí¹ñÖâ¿G¡@ÕÚìHËÃÑiôğáC€‚";
		mes "è§¡@€‰öfìÖÔ\®ş€ç¡@è¦¼Ã¡@Ãì€äßZÂí£¸ÕÚî¿¡@¡@Áí§!";
		next;
		switch(select("¡@«¡¨j¡@£¸Ôt¡@¸ó¡@ - 150z:ìN¡@İµìL¡@öò - 1000z:ºdäõìÆìL¡@öò - 3000z:²ØÏ²¡@¡@¡@¡@ìL¡@öò - 5000z:ºı¡@æU¡@¡@¡@")) {
		case 1:
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "¾ü¬ÉÕÚëæ¡@¡@¡@¡@ÔV·åËµ³İ¯KªO¡@ø¯¡@áø¡@?";
			mes "¼cÓ³Úé¡@¡@®óóq¡@ÕÚæ¢éô¡@¡@‰'0'ä±‚";
			next;
			while(1) {
				input .@input;
				if (.@input == 0) {
					mes "[îãìÒÕQóc¡@¡@²ÙÃf";
					mes "¡@¡@¡@®fÓ³Úêºı¡@æUä±ØZ¡@ñd¡@³Jä±‚";
					close;
				}
				else if ((.@input < 0) || (.@input > 500)) {
					mes "[îãìÒÕQóc¡@¡@²ÙÃf";
					mes "æ¢®p¡@íi¡@«ı¡@¦ñ¡@îÙ¡@ÑJ500®ş¡@¤¬®şéY€‚";
					next;
				}
				else {
					break;
				}
			}
			.@sell = .@input * 150;
			if (Zeny < .@sell) {
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ñiİt¡@¾Èİäğo®ş¡@ÀôÃñ·Î¤ZºıÉáåÎÃì€äßXôğ¡@Â²ëæ¡@¡@®şÂEğo¯KØ©ßXôğ¡@ÀôìNåxÓQñS€ä¤¬¯K¡@ÓGîãËµ¡@ÂzÔíÓFÜd¡g€¦";
				close;
			}
			if (checkweight(612,.@input) == 0) {
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ÒF¡@¯fÁîÏ´¡@¡@«¡¨jâY¡@¡@¿G²BÖĞŞ¶«±å¾!";
				close;
			}
			getitem 612,.@input; // Portable_Furnace
			Zeny = Zeny-.@sell;
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "Âï¡@ªüÂí£¸ÕÚîã¡@Î`ëæÉÙ¡@âY¡@ÓB¼c¡@Ôp®ş´!";
			close;
		case 2:
			if (Zeny < 1000) {
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ñiİt¡@¾Èİäğo®ş¡@ÀôÃñ·Î¤ZºıÉáåÎÃì€äßXôğ¡@Â²ëæ¡@¡@®şÂEğo¯KØ©ßXôğ¡@ÀôìNåxÓQñS€ä¤¬¯K¡@ÓGîãËµ¡@ÂzÔíÓFÜd¡g€¦";
				close;
			}
			getitem 613,1; // Iron_Hammer
			Zeny = Zeny-1000;
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "Âï¡@ªüÂí£¸ÕÚîã¡@Î`ëæÉÙ¡@âY¡@ÓB¼c¡@Ôp®ş´!";
			close;
		case 3:
			if (Zeny < 3000) {
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ñiİt¡@¾Èİäğo®ş¡@ÀôÃñ·Î¤ZºıÉáåÎÃì€äßXôğ¡@Â²ëæ¡@¡@®şÂEğo¯KØ©ßXôğ¡@ÀôìNåxÓQñS€ä¤¬¯K¡@ÓGîãËµ¡@ÂzÔíÓFÜd¡g€¦";
				close;
			}
			getitem 614,1; // Golden_Hammer
			Zeny = Zeny-3000;
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "Âï¡@ªüÂí£¸ÕÚîã¡@Î`ëæÉÙ¡@âY¡@ÓB¼c¡@Ôp®ş´!";
			close;
		case 4:
			if (Zeny < 5000) {
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ñiİt¡@¾Èİäğo®ş¡@ÀôÃñ·Î¤ZºıÉáåÎÃì€äßXôğ¡@Â²ëæ¡@¡@®şÂEğo¯KØ©ßXôğ¡@ÀôìNåxÓQñS€ä¤¬¯K¡@ÓGîãËµ¡@ÂzÔíÓFÜd¡g€¦";
				close;
			}
			getitem 615,1; // Oridecon_Hammer
			Zeny = Zeny-5000;
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "Âï¡@ªüÂí£¸ÕÚîã¡@Î`ëæÉÙ¡@âY¡@ÓB¼c¡@Ôp®ş´!";
			close;
		case 5:
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "¼c¡@¡@¡@¡@ÑJ'îãìÒÕQóc¡@¡@²Ù'ôğáD¥ïÒFŞ[¡@";
			close;
		}
	case 3:
		mes "[îãìÒÕQóc¡@¡@²ÙÃf";
		mes "ñi¡@¾¼¿G¡@Â²¾È³ú¡@İÓéÍ¤t¡@ÉàÕÚ¡@¡@¡@ä±Ø\¡@¡@£µ¡@îî€è¡@¡@¡@¡@¿¨¡@é¡?";
		next;
		switch(select("¼d«¡ìÙÎg¡t¡@¡@¡@¡@-ºí¡@áø®ş€ - 200z:¼d«¡ìÙÎg¡t¡@¡@¡@¡@-ºí¡@áø¡@Œ - 1000z:îíÑïÖÇ")) {
		case 1:
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "¡@ªO¡@ÒF¡@ÚV·åË¼«ı¿G´ãÍuÁë¢?ÀáØQõ×ÒF¡@ÓGîÏ¥R«ıÒW¿ĞßZ®şŞN¡@ëæ¡@¡@ËC¼Ã¡@¡@ªO¡@'0'";
			next;
			while(1) {
				input .@input;
				if (.@input == 0) {
					mes "[îãìÒÕQóc¡@¡@²ÙÃf";
					mes "¡@¡@¡@îíÑïÖÇ";
					mes "îØá¬¡@!";
					close;
				}
				else if ((.@input < 0) || (.@input > 500)) {
					mes "[îãìÒÕQóc¡@¡@²ÙÃf";
					mes "îí¡@¡@íi¡@«ı500®ş¡@¡@Æ_¡@Ïrø¯‘";
					next;
				}
				else {
					break;
				}
			}
			.@sell = .@input * 200;
			if (Zeny < .@sell) {
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ñiİt¡@¾Èİäğo®ş¡@ÀôÃñ·Î¤ZºıÉáåÎÃì€äßXôğ¡@Â²ëæ¡@¡@®şÂEğo¯KØ©ßXôğ¡@ÀôìNåxÓQñS€ä¤¬¯K¡@ÓGîãËµ¡@ÂzÔíÓFÜd¡g€¦";
				close;
			}
			if (checkweight(1010,.@input) == 0) {
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ÒF¡@¯fÁîÏ´¡@¡@«¡¨jâY¡@¡@¿G²BÖĞŞ¶«±å¾!";
				close;
			}
			getitem 1010,.@input; // Phracon
			Zeny = Zeny-.@sell;
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "Âï¡@ªüÂí£¸ÕÚîã¡@Î`ëæÉÙ¡@âY¡@ÓB¼c¡@Ôp®ş´!";
			close;
		case 2:
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "¡@ªO¡@ÒF¡@ÚV·åË¼«ı¿G´ãÍuÁë¢?ÀáØQõ×ÒF¡@ÓGîÏ¥R«ıÒW¿ĞßZ®şŞN¡@ëæ¡@¡@ËC¼Ã¡@¡@ªO¡@'0'";
			next;
			while(1) {
				input .@input;
				if (.@input == 0) {
					mes "[îãìÒÕQóc¡@¡@²ÙÃf";
					mes "¡@¡@¡@îíÑïÖÇ";
					mes "îØá¬¡@!";
					close;
				}
				else if ((.@input < 0) || (.@input > 500)) {
					mes "[îãìÒÕQóc¡@¡@²ÙÃf";
					mes "îí¡@¡@íi¡@«ı500®ş¡@¡@Æ_¡@Ïrø¯‘";
					next;
				}
				else {
					break;
				}
			}
			.@sell = .@input * 1000;
			if (Zeny < .@sell) {
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ñiİt¡@¾Èİäğo®ş¡@ÀôÃñ·Î¤ZºıÉáåÎÃì€äßXôğ¡@Â²ëæ¡@¡@®şÂEğo¯KØ©ßXôğ¡@ÀôìNåxÓQñS€ä¤¬¯K¡@ÓGîãËµ¡@ÂzÔíÓFÜd¡g€¦";
				close;
			}
			if (checkweight(1011,.@input) == 0) {
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ÒF¡@¯fÁîÏ´¡@¡@«¡¨jâY¡@¡@¿G²BÖĞŞ¶«±å¾!";
				close;
			}
			getitem 1011,.@input; // Emveretarcon
			Zeny = Zeny-.@sell;
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "Âï¡@ªüÂí£¸ÕÚîã¡@Î`ëæÉÙ¡@âY¡@ÓB¼c¡@Ôp®ş´!";
			close;
		case 3:
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "¼c¡@¡@¡@¡@ÑJ'îãìÒÕQóc¡@¡@²Ù'ôğáD¥ïÒFŞ[¡@";
			close;
		}
	case 4:
		mes "[îãìÒÕQóc¡@¡@²ÙÃf";
		mes "ñiİtğo¡@¡@¡@ÒW¡@¡@ÒFŞG¡@íi£¸ÕÚ¡@¡@¡@¡@¸ó¡@ëæŒ5®ş¡@¡@¯KìÖìÆÅô¡@®v¡@¨R¡@ÒW¡@¡@ÒF·ÉÎ]®ş€ä°y²ØÏ²¡@¡@¡@¡@ëæŒ5®ş¡@ºQîÔ¡@¡@îí¡@¤¬îâ¦·ßcñi¡@¡@®ş¡@ºQëæÉÖ¡@ñS¡@¡@Áç´ã¡@®ş€ç¡@Áë¢?";
		next;
		switch(select("îâ¦·ßc²ØÏ²¡@¡@¡@¡@:îâ¦·ßcìH:îíÑïÖÇ")) {
		case 1:
			if (countitem(756) < 5) {
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ñi¡@å¨æ¢ÑYÁ^ÒF 5®ş¡@¡@¯KìÖìÆÅô¡@®v¡@¦äåMùVÂÇ¡@®ş€ä°y²ØÏ²¡@¡@¡@¡@";
				close;
			}
			else {
				delitem 756,5;  //Oridecon_Stone
				getitem 984,1; // Oridecon
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ºı¡@¡@®ş€ä°y²ØÏ²¡@¡@¡@¡@ëæÉÙ¡@âY¡@¡@®ş¡@¡@îØá¦¡@!";
				close;
			}
		case 2:
			if (countitem(757) < 5) {
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ñi¡@å¨æ¢ÑYÁ^ÒF 5®ş¡@ºQîÔ¡@¡@ñSá¬¡@¡@¡@¡@®ş¡@ºQ";
				close;
			}
			else {
				delitem 757,5;  //Elunium_Stone
				getitem 985,1; // Elunium
				mes "[îãìÒÕQóc¡@¡@²ÙÃf";
				mes "ºı¡@¡@®ş€ä°yìH¡@ÓQ¼c¡@¡@ÒF¡@ÓB¼c¡@Ô©¡@¥!";
				close;
			}
		case 3:
			mes "[îãìÒÕQóc¡@¡@²ÙÃf";
			mes "ÒF¡@ÚV·å¨ŞÕÚÃë¸ö€™ëæÉÙ¡@âYÑuåóÃë¸öÔ©¡@¡@ÓQîØá¬¡@!";
			close;
		}
	case 5:
		mes "[îãìÒÕQóc¡@¡@²ÙÃf";
		mes "¼c¡@¡@îòÉá¡@¡@¥'îãìÒÕQóc¡@¡@²Ù'ôğáD¥ïÒFŞ[¡@.";
		close;
	}
}

// Paul Spanner: Einbroch Blacksmith Supplier
//============================================================
ein_in01,38,29,0	script	Paul Spanner	63,{
	if (checkweight(1201,1) == 0) {
		mes "- Wait a minute !! -";
		mes "- Currently you're carrying -";
		mes "- too many items with you. -";
		mes "- Please try again -";
		mes "- after you lose some weight. -";
		close;
	}
	mes "[Paul Spanner]";
	mes "Welcome, my friend.";
	mes "In my shop, you will find everything that you need in forging.";
	mes "Tell me what you need.";
	next;
	switch(select("Purchase Anvil.:Purchase Forging Items.:Purchase Metal.:Process Ores.:Quit.")) {
	case 1:
		mes "[Paul Spanner]";
		mes "Anvil is the most necessary item for Blacksmiths.";
		mes "Since you will use an Anvil more than once, you'd better buy a nice one.";
		next;
		switch(select("Anvil - 30,000z.:Oridecon Anvil - 120,000z.:Golden Anvil - 300,000z.:I need a better anvil.:Cancel.")) {
		case 1:
			if (Zeny < 30000) {
				mes "[Paul Spanner]";
				mes "With that much of money, you cannot even buy a toy anvil!";
				close;
			}
			getitem 986,1; //Anvil
			Zeny = Zeny-30000;
			mes "[Paul Spanner]";
			mes "It is the cheapest anvil which has the most basic ability.";
			mes "Thank you for using my shop. If you need anything, just let me know.";
			close;
		case 2:
			if (Zeny < 120000) {
				mes "[Paul Spanner]";
				mes "With that much of money, you cannot even buy a toy anvil!";
				close;
			}
			getitem 987,1; //Oridecon_Anvil
			Zeny = Zeny-120000;
			mes "[Paul Spanner]";
			mes "Ah, you have an eye for anvil. A Blacksmith needs an anvil at least as good as this.";
			mes "Thank you for using my shop. If you need anything, just let me know.";
			close;
		case 3:
			if (Zeny < 300000) {
				mes "[Paul Spanner]";
				mes "With that much of money, you cannot even buy a toy anvil!";
				close;
			}
			getitem 988,1; //Golden_Anvil
			Zeny = Zeny-300000;
			mes "[Paul Spanner]";
			mes "I can tell your ambition to become a good Blacksmith just by looking at you to choose this Golden Anvil!";
			mes "This anvil will surely aid you in creating the best weapons.";
			close;
		case 4:
			mes "[Paul Spanner]";
			mes "I am sorry, but I do not sell better anvils than Golden Anvil.";
			mes "Unless you find the legendary anvil of 'Linggell', I don't think that you could find better one than Golden Anvil in any other places.";
			close;
		case 5:
			mes "[Paul Spanner]";
			mes "If you need anything, just let me know.";
			close;
		}
	case 2:
		mes "[Paul Spanner]";
		mes "You need various materials to process ores and to forge weapons.";
		mes "I have everything that you need. Take a look.";
		next;
		switch(select("Mini Furnace - 150z.:Iron Hammer - 1,000z.:Golden Hammer - 3,000z.:Oridecon Hammer - 5,000z.:Cancel.")) {
		case 1:
			.@item = 612;
			.@item_cost = 150;
			.@item_weight = 200;
			mes "[Paul Spanner]";
			mes "You definately need this furnce to process ores!";
			next;
			break;
		case 2:
			.@item = 613;
			.@item_cost = 1000;
			.@item_weight = 200;
			break;
		case 3:
			.@item = 614;
			.@item_cost = 3000;
			.@item_weight = 300;
			break;
		case 4:
			.@item = 615;
			.@item_cost = 5000;
			.@item_weight = 400;
			break;
		case 5:
			mes "[Paul Spanner]";
			mes "If you need anything, just let me know.";
			close;
		}
		mes "[Paul Spanner]";
		mes "So, how many do you need? If you want to cancel the trade, enter '0'.";
		next;
		while(1) {
			input .@input;
			if (.@input == 0) {
				mes "[Paul Spanner]";
				mes "You have canceled the trade. If you need anything, just let me know.";
				close;
			}
			else if ((.@input < 0) || (.@input > 500)) {
				mes "[Paul Spanner]";
				mes "You can only buy 500 or less at a time.";
				next;
			}
			else {
				break;
			}
		}
		.@sell = .@input * .@item_cost;
		if (Zeny < .@sell) {
			mes "[Paul Spanner]";
			mes "You don't have enough money. Sorry, I cannot sell them at a loss.";
			close;
		}
		if (checkweight(.@item,.@input) == 0) {
			mes "[Paul Spanner]";
			mes "Hey, you look pale. Why don't you go lighten your weight first.";
			close;
		}
		Zeny = Zeny-.@sell;
		getitem .@item,.@input;
		mes "[Paul Spanner]";
		mes "Thank you for using my shop. If you need anything, just let me know.";
		close;
	case 3:
		mes "[Paul Spanner]";
		mes "I have high quality metal.";
		mes "So, which metal would you like to buy?";
		next;
		switch(select("Phracon - 200z.:Emveretarcon - 1,000z.:Quit.")) {
		case 1:
			.@item = 1010;
			.@item_price = 200;
			break;
		case 2:
			.@item = 1011;
			.@item_price = 1000;
			break;
		case 3:
			mes "[Paul Spanner]";
			mes "If you need anything, just let me know.";
			close;
		}
		mes "[Paul Spanner]";
		mes "So, how many of them do you need? If you want to cancel the trade, enter '0'.";
		next;
		while(1) {
			input .@input;
			if (.@input == 0) {
				mes "[Paul Spanner]";
				mes "The trade has been canceled. If you need anything, just let me know.";
				close;
			}
			else if ((.@input < 0) || (.@input > 500)) {
				mes "[Paul Spanner]";
				mes "You can buy 500 or less at a time.";
				next;
			}
			else {
				break;
			}
		}
		.@sell = .@input * .@item_price;
		if (Zeny < .@sell) {
			mes "[Paul Spanner]";
			mes "You don't have enough money. Sorry, I cannot sell them at a loss.";
			close;
		}
		if (checkweight(.@item,.@input) == 0) {
			mes "[Paul Spanner]";
			mes "Hey, you look pale. Why don't you go lighten your weight first?";
			close;
		}
		getitem .@item,.@input;
		Zeny = Zeny-.@sell;
		mes "[Paul Spanner]";
		mes "Thank you for using my shop. If you need anything, just let me know.";
		close;
	case 4:
		mes "[Paul Spanner]";
		mes "I can process Oridecon and Elunium for you.";
		mes "You need 5 ores to process them into one Oridecon or Elunium.";
		mes "So, which one do you want to process?";
		switch(select("Oridecon:Elunium:Quit.")) {
		case 1:
			if (countitem(756) < 5) {
				mes "[Paul Spanner]";
				mes "You need 5 ores to process them into one pure Oridecon.";
				close;
			}
			else {
				delitem 756,5; //Oridecon_Stone
				getitem 984,1; //Oridecon
				mes "[Paul Spanner]";
				mes "There you go. Thank you for using my service.";
				close;
			}
		case 2:
			if (countitem(757) < 5) {
				mes "[Paul Spanner]";
				mes "You need 5 ores to process them into one pure Elunium.";
				close;
			}
			else {
				delitem 757,5; //Elunium_Stone
				getitem 985,1; //Elunium
				mes "[Paul Spanner]";
				mes "There you go. Thank you for using my service.";
				close;
			}
		case 3:
			mes "[Paul Spanner]";
			mes "If you need anything, just let me know.";
			close;
		}
	case 5:
		mes "[Paul Spanner]";
		mes "If you need anything, just let me know.";
		close;
	}
}

// Weapon/Armor Refiners
//============================================================
prt_in,63,60,0	script	î¿ÂÇ¡@âY	85,{
	callfunc "refinemain","î¿ÂÇ¡@âY",0;
	end;
}
morocc_in,73,38,6	script	¡@¡@Üö¡@˜	99,{
	callfunc "refinemain","¡@¡@Üö¡@˜",0;
	end;
}
payon,144,173,5	script	ôe¡@ÖĞø¯·Î¡@	88,{
	callfunc "refinemain","ôe¡@ÖĞø¯·Î¡@",0;
	end;
}
alberta_in,28,58,0	script	¼dİĞ¡@¾È®p¡@	85,{
	callfunc "refinemain","¼dİĞ¡@¾È®p¡@",0;
	end;
}
yuno_in01,171,21,4	script	ø¯¡@€¡@¹	88,{
	callfunc "refinemain","ø¯¡@€¡@¹",0;
	end;
}
ein_in01,24,87,5	script	óa·Î¡@óc¡@¡@	826,{
	callfunc "refinemain","óa·Î¡@óc¡@¡@",0;
	end;
}
lhz_in02,282,20,7	script	²Ù¡@¡@	869,{
	callfunc "refinemain","²Ù¡@¡@",0;
	end;
}

//============================================================
//= Main Refiner Function
//============================================================
//= To allow auto safe refining/multiple refining set the
//= second argument to '1' in the function call.
//= If you enable this function, be sure to edit the value of
//= .@safe to the max safe refine in refine_db.txt as well.
//============================================================
function	script	refinemain	{
	.@npc_name$ = getarg(0);
	.@features = getarg(1);

	if( getbattleflag( "feature.refineui" ) == 3 ){
		mes "["+ .@npc_name$ +"]";
		mes "I've spent a long time refining powerful weapons.";
		mes "You are in the presence of ???? [Zhang Zhuangtan]"; // TODO: find a valid translation
		mes "Do you want to strengthen your equipment?";
		close2;
		refineui();
		end;
	}

	disable_items;
	mes "["+ .@npc_name$ +"]";
	mes "I'm the Armsmith.";
	mes "I can refine all kinds of weapons, armor and equipment, so let me";
	mes "know what you want me to refine.";
	next;

	setarray .@indices[1], EQI_HEAD_TOP, EQI_ARMOR, EQI_HAND_L, EQI_HAND_R, EQI_GARMENT, EQI_SHOES, EQI_ACC_L, EQI_ACC_R, EQI_HEAD_MID, EQI_HEAD_LOW;
	for(.@i = 1; .@i<getarraysize(.@indices); ++.@i) {
		if(getequipisequiped(.@indices[.@i])) {
			.@menu$ = .@menu$ + F_getpositionname(.@indices[.@i]) + "-[" + getequipname(.@indices[.@i]) + "]";
			.@equipped = 1;
		}
		else
			set .@menu$, .@menu$ + F_getpositionname(.@indices[.@i]) + "-[®[¢JÙó·è¡@¡@]";
		.@menu$ = .@menu$ + ":";
	}
	if (.@equipped == 0) {
		mes "[" + .@npc_name$ + "]";
		mes "ÒF¡@¡@ÎgºÀ€’óq¡@¡@·è¡@¡@²Ò¦j¡@îãˆ...";
		close;
	}
	.@part = .@indices[select(.@menu$)];

	if(!getequipisequiped(.@part)) { //custom check
		mes "[" + .@npc_name$ + "]";
		mes "·åË¼ÓG·åËÁ¡@¡@°ú¡@ôğáD¡@ùrİrÃ¯ôï·Îæí";
		mes "ùU¡@¡@®ş€çÔ`¡@Š?";
		emotion ET_FRET;
		close;
	}
	//Check if the item is refinable...
	if(!getequipisenableref(.@part)) {
		mes "[" + .@npc_name$ + "]";
		mes "ÒF¡@€‰®ş¡@ÕÚâY¡@°y·è¡@¡@óq¡@Ù¶®\ÃmÃ¯ôïªÓÕÚè¦¼Ã¡@îÚ”!";
		close;
	}
	//Check to see if the items is already +10
	if(getequiprefinerycnt(.@part) >= 10) {
		mes "[" + .@npc_name$ + "]";
		mes "âY¡@Åw·è¡@¡@®fÓ³ÚêìLÃ¸¤£îâ°10ºí¡@Â².";
		mes "ÒW¡@¡@ôğ¡@¡@Áî›, Ãë¡@¡@îØá«¡@è§¡@Â²..";
		close;
	}
	.@refineitemid = getequipid(.@part); // save id of the item
	.@refinerycnt = getequiprefinerycnt(.@part); //save refinery count
	setarray .@card[0], getequipcardid(.@part,0), getequipcardid(.@part,1), getequipcardid(.@part,2), getequipcardid(.@part,3);
	.@price = getequiprefinecost(.@part, REFINE_COST_NORMAL, REFINE_ZENY_COST);
	.@material = getequiprefinecost(.@part, REFINE_COST_NORMAL, REFINE_MATERIAL_ID);

	switch (getequipweaponlv(.@part)) {
		case 1: .@safe = 7; break;
		case 2: .@safe = 6; break;
		case 3: .@safe = 5; break;
		case 4:
		default: .@safe = 4; break;
	}

	// If the VIP system is enabled, the prices for non-VIP players are considerably higher.
	if (VIP_SCRIPT && !vip_status(VIP_STATUS_ACTIVE)) {
		switch(getequipweaponlv(.@part)) {
			case 0: .@price = .@price * 10; break;
			case 1: .@price = .@price * 40; break;
			case 2: .@price = .@price * 50; break;
			case 3: .@price = .@price * 2; break;
			case 4: .@price = .@price * 2; break;
			case 5: .@price = .@price * 10; break;
		}
	}

	if(.@features != 1) {
		mes "[" + .@npc_name$ + "]";
		mes "ºö¼@ÓLâY¡@°y¡@¡@İµñi¡@ÚV·å:";
		mes "- ^0000ff"+getitemname(.@material)+"^000000 x 1";
		mes "- ºö¼@¡@Ãì¡@¡@íi¹ ^ff0000"+ .@price + "^000000 Zeny";
		mes "ÒFÊDÚBôğáD¡@Ãì¡@¡@ºı¡@µeÁí—?";
		next;
		if(select("óq¡@ÕÚ, ºı¡@µeÁí§:âYéÌåÎßX¡@Â²Áí§...") == 2){
			mes "[" + .@npc_name$ + "]";
			mes "Æ_¶...";
			mes "¾[¢í¡@Áí§, ¼c¡@¡@®ş¡@¡@îØá¦¡@!";
			close;
		}
		if(getequippercentrefinery(.@part, REFINE_COST_NORMAL) < 100) {
			mes "[" + .@npc_name$ + "]";
			mes "¾[¢î¡@·å¨Ş¤áºı¡@Ã¯ôï·Î¡@¡@¡@áÜ?";
			mes "âY÷àÚBóq¡@¡@®ş¡@ÙóîòÄß®`ôğ¡@¼gñi¾ì¡@¡@Ôí¡@!";
			switch(.@material) {
			case 985:
				mes "^ff0000öf¡@¡@âY÷á¡@¿GÊ¨¤ZºıÉàÃ¯ôï·Î¡@¿G¡@¡@¡@ÜßÕÚÃñ®pöò...";
				mes "·åËÁåÎîØ¹ò¤áºı¡@Ã¯ôïªÓÕÚæ¢,";
				mes "ñi¡@€•¡@Ï²ÓG¾üÂÇ¡@ùV§Ù²Óè§¡@Î]·è¡@¡@¡@¡@¡@îÚ”!!!^000000";
				break;
			default:
				mes "^ff0000·åËÁåÎ¡@¡@¡@ôğ¡@ênîí¡@®ò®şá¬¡@ºı¡@µeÒF¸óÙu¡@†!!";
				mes "¡@Õ¤¡@¡@¡@¼ìôğáDØç¡@Ê¨Îæ¡@äõÒ½¯K¡@0000ffîã£ºñë®P³ú¡@^ff0000!!";
				mes "·è¡@¡@¯K¡@²Ó®P³ú¡@¡@¡@áÜ, ÒFÊD¡¥ôeºr¡@ºı¡@µeÁí—?";
				break;
			}
			next;
			mes "["+getarg(0)+"]";
			mes "ñiİt¡@îØá¬¡@®ş€æ¡@, ®ş€æÙ°·è¡@¡@¡@¡@¡@¡@†,";	
			mes "¾[¢ì¡@ôe¡@®ò«¹ºqÂº®P³ú¡@, ®şá¬¡@îØ¹ñ¼b¡@£µÂ².";
			mes "¯K¡@®òóq¡@¡@, ÒF¡@¼ì®ş¤oâ­®ş€ä°yè§¡@á{";
			mes "^FF0000ºı¡@µeôğ¡@ên, îí¡@¡@ÒZ¡@®×âYŞ[¡@îÔ©üğo®ş¡@¡@¿Gäù000000 .";
			mes "ÒFÊDÚBôğ¡@¡¥ôeºr¡@ºı¡@µeÁí—?";
			next;
			if(select("ºı¡@µeÁí§, îÏ¨RåvîÔ¡@¡@Âî©ü¡@ñSÎØİCÙÊÑuÃrôğ„!:ñi¡@¿E®şá¬·o, ßX¡@Â²...") == 2){
				mes "[" + .@npc_name$ + "]";
				mes "ñi¡@Ú®îã£¸ÕQ·ê¢ì¡@ósÄß¯ÂôğáD®vÁæ ...";
				mes "¡@¡@€•ñi¡@®òóq¡@¡@®ş¡@¡@ôğ¡@Ã¯ôï·ÎĞB,";
				mes "ÒFÜÙ¡@ÒZ¡@ÙóÁç¸öŞÖîÙ¬xÑÍôğ¡@¡@Áå™...";
				close;
			}
		}
		if((countitem(.@material) < 1) || (Zeny < .@price)) {
			mes "[" + .@npc_name$ + "]";
			mes "ÒF¡@¯fÃìÑY­á¿G¡@ÕÚ¡@¡@Ñ·ñi¡@€… ^0000ff"+getitemname(.@material)+"^000000...";
			mes "Áæ¡@á´ñV¦j¡@¡@¡@¡@, ñi¡@²Ó¡@£¹ğo¡@¡@¡@ÒFÊDÕÚ.";
			close;
		}
		Zeny = Zeny-.@price;
		delitem .@material,1;

		// anti-hack
		if (callfunc("F_IsEquipIDHack", .@part, .@refineitemid) || callfunc("F_IsEquipCardHack", .@part, .@card[0], .@card[1], .@card[2], .@card[3]) ||
		    callfunc("F_IsEquipRefineHack", .@part, .@refinerycnt)) {
			mes "["+ .@npc_name$ +"]";
			emotion ET_FRET;
			mes "µ¼¡@¡@ÒZ´ã¡@..";
			mes "ÒF¡@¤¬®ş¯M¡@óq¡@¡@¡@À§¡@?!";
			mes "î¿¡@ññîÔ», ®ş¹ò¡@ñi¡@²Ó¡@£·¡@ôğäõİµìL¡@¼\ÒF ..";
			close;
		}

		if(getequippercentrefinery(.@part, REFINE_COST_NORMAL) <= rand(100)) {
			failedrefitem .@part;
			mes "["+ .@npc_name$ +"]";
			emotion (!rand(5))?ET_MONEY:ET_HUK;
			.@lose = rand(1,3);
			if (.@lose == 1) {
				mes "¡@¦! ñiİrÕÚ¿G©!! ôe¾­ÚBôğ¡@¡@îê¡@Â²...";
				mes "ô\³W¡@ñiİrÚBôğáD¡@îâÜËæ`Ú¬§iÎqÎg‰,";
				mes "®şá¬Á^¿G´ã¡@ºı¡@½dô\³W¡@Ãì¡@¡@¿G¡@ÓGóq¡@¡@?";
			} else if(.@lose == 2) {
				mes "îÕ¨RÑÉîÕ¨RÑÉîÕ¨RÑÉîÕ³!!!";
				mes "·è¡@¡@¡@£¸Ã¯ôïªÓÕÚâY¡@¡¿®ş¡@¡@îê¡@Â².";
				mes "ô\¹...ô\³}ÓGÂz·...";
			} else {
				mes "ÅI°! ¡@Ôí¡@¡@Ôí¡@~~ ";
				mes "·è¡@¡@¡@£¸Ã¯ôïªÓÕÚâY¡@¡¿®ş¡@¡@îê¡@Â².";
				mes "¾È¡@ÎqÎg‰, öf¡@ÕÚîàËÃ¡@¡@¿ë¡@...";
			}
			close;
		}
		mes "["+getarg(0)+"]";
		successrefitem .@part;
		emotion ET_SMILE;
		.@win = rand(1,3);
		if (.@win == 1) {
			mes "¿G¡@¡@¡@†! ¡@³ú¡@!";
			mes "·åË¼ÓG·åËÃÔ©¡@¡@¡@¼c¡@éx~~";
			mes "¾ü§Ùã[®[¢CÃ¯ôï·ÎññâY¡@¡@ÒZéÍ¤tôğ¡@¡@¿G¡@Â²,";
			mes "·è¡@¡@îí¾ì¤v¡@ÜÙ¡@®ş€åæ®¯K¡@¡@İÓ¾ì¡@Áí§?";
		} else if(.@win == 2) {
			mes "Áò¡@¤÷¾ü½, ñiáÂÎo¡@†..!";
			mes "âYÅÏåÎÒFÊDÕÚ·è¡@¡@, ñV«±á´Áí§!";
			mes "¾ü§Ùã[®[¢CÃ¯ôï·ÎññâY¡@¡@ÒZéÍ¤tôğ¡@¡@¿G¡@Â².";
		} else {
			mes "¡@³ú¡@! ñi¡@Ú®ñi¡@Â².";
			mes "®şá¬¡@Âî€çÌÖñiİrÕÚ®f¡@ßcùVÂÇÌF.";
			mes "Æ^¡@æ®îí¡@¤¬²NéôºÇÒF¡@©·Âï.";
			mes "·è¡@¡@îí¾ì¤v¡@ÜÙ¡@®ş€åæ®¯K¡@¡@İÓ¾ì¡@Áí§?";
		}
		close;
	}

// New Refining Functions ========================
	if (.@refinerycnt < .@safe) {
		mes "[" + .@npc_name$ + "]";
		mes "ÒF¡@¡@ÒW¡@€‰ñV¡@Ïr¡@¡@¡@îØ¸öÑJôe¡@¡@ÁåÆPÓQñiÑïåÎ·åË¶¡@îØ¨ïÕÚ¼c¢Jáø... ñi¡@¡@®[¢J¡@·ê......";
		next;
		.@menu2 = select("ìL»£Ü×îâªO¡@îã£¶€¼.","æ¦ùó¡@¡@¡@¡@ôeÉ¡¡@îØ¨ïÕÚ¼c¢Jáø.","ñi¡@é±îí¾ğ´IÂï¡@Â²...");
	} else
		.@menu2 = 2;
	switch(.@menu2){
	case 1: 
		.@refinecnt = .@safe - .@refinerycnt;
		break;
	case 2:
		next;
		mes "[" + .@npc_name$ + "]";
		mes "¾[¢ì¡@ëæÉÖ¡@·åËÁ¡@Ú¬¡@¡@ìL»£Ü×¿G´ãÍu¼c¡@é¡?";
		next;
		input .@refinecnt;
		.@refinecheck = .@refinecnt + .@refinerycnt;
		if (.@refinecnt < 1 || .@refinecheck > 10) {
			mes "[" + .@npc_name$ + "]";
			mes "ñi¡@ÓGùVÂÇÔ©ºö¼@ÓLâY¡@°y¡@¡@İµ¡@¦.";
			close;
		}
		if(.@refinecheck > .@safe) {
			.@refinecheck = .@refinecheck - .@safe;
			mes "[" + .@npc_name$ + "]";
			mes "¾[¢ì¡@ëæÉÙ¡@·åËÃÓRÀäìÖ¡@îØ¶  + .@refinecheck +  ¼c¡¹ÓQâY÷â¡@ÅĞÎIÁ^ôe¡@æ®Áå¼. ÒFÊDÕÚ·è¡@¡@Ãì¡@¡@ùV§Ù²ÓîêÉá¡@... ·åË¶¡@îØ¸ö¡@?";
			next;
			if(select("¾ü¬ÉÕÚ...","ßX¡@Â²...") == 2){
				mes "[" + .@npc_name$ + "]";
				mes "âY÷â¡@óq¡@¡@æ¢¤oÕÚ¡@¦...";
				close;
			}
		}
		break;
	case 3:
		next;
		mes "[" + .@npc_name$ + "]";
		mes "âY÷â¡@óq¡@¡@æ¢¤oÕÚ¡@¦...";
		close;
	}
	.@fullprice = .@price * .@refinecnt;
	mes "[" + .@npc_name$ + "]";
	mes "Âî»£èûîî€è¡@" + .@refinecnt + " " + getitemname(.@material) + " ÒW¡@±jíi¦cÙu " + .@fullprice + " Zeny... ·åË¶¡@îØ¸ö¡@?";
	next;
	if(select("¾ü¬ÉÕÚ","ßX¡@Â²...") == 2){
		mes "[" + .@npc_name$ + "]";
		mes "âY÷â¡@óq¡@¡@æ¢¤oÕÚ¡@¦...";
		close;
	}
	if(countitem(.@material) < .@refinecnt || Zeny < .@fullprice) {
		mes "[" + .@npc_name$ + "]";
		mes "âY¡@¡@ø¯¿ëåÎÒF¡@¡@ñV¡@Ùóôğ¡@¡@ÃìÌBéL¡@ËÃ¡@?¡@¬É¡@¾È³ú¡@îÏŞfÓQÒF¡@åÎÒFÊDÕÚ¡@¡@¡@®şá¬­áëæÉÙ¡@¯K¡@ís¡@£¸¡@Æq¡@¡@ÁîùáÓQîØá¬¡@ëæÉÙ¡@ÒW¾ìññ¯K¡@¡@æ¢¡@æí·åËÁÙóñS€æå¿Æq®påÕ!";
		close;
	}
	Zeny = Zeny - .@fullprice;
	delitem .@material,.@refinecnt;
	while(.@refinecnt){
		if (getequipisequiped(.@part) == 0) {
			mes "[" + .@npc_name$ + "]";
			mes "ô\³}ÓGÂz·,¡@¡@¡@®ş¡@¡@ñi¡@¡@®şá¬¡@Ú¬¡@¡@.....";
			close;
		}
		// anti-hack
		if (callfunc("F_IsEquipIDHack", .@part, .@refineitemid) || callfunc("F_IsEquipCardHack", .@part, .@card[0], .@card[1], .@card[2], .@card[3]) ||
				callfunc("F_IsEquipRefineHack", .@part, .@refinerycnt) || (.@menu2 == 1 && getequippercentrefinery(.@part, REFINE_COST_NORMAL) < 100)) {
			mes "[" + .@npc_name$ + "]";
			mes "®şá¬¡@¼d€ç¡@Úû¡@Â²,ÒF¡@¤¬®ş¯M¡@óq¡@¡@¡@À§¡@ !! !?!";
			mes "î¿¡@ññîÔ»...";
			mes "®ş¹ò¡@ñi¡@²Ó¡@£·¡@ôğäõİµìL¡@¼\ÒF ..!!!";
			close;
		} 
		mes "¡@áÂ¡@, ¡@áÂ¡@!!!";
		if(.@menu2 == 2 && getequippercentrefinery(.@part, REFINE_COST_NORMAL) <= rand(100)) {
			failedrefitem .@part;
			emotion ET_HUK;
			mes "[" + .@npc_name$ + "]";
			mes "îÕ¨RÑÉîÕ¨RÑÉîÕ¨RÑÉîÕ³!!! Îg¡t¡@¡@£¸Ã¯ôïªÓÕÚâY¡@¡¿®ş¡@¡@îê¡@Â²...";
			.@refinecnt = .@refinecnt - 1;
			if(.@refinecnt == 0) close;
			mes "âYÅÏåÎ¡@¡@ÓBôğäõÑ·îÕÉÙæOóc™...";
			getitem .@material,.@refinecnt;
			.@fullprice = .@refinecnt * .@price;
			Zeny = Zeny + .@fullprice;
			close;
		}
		successrefitem .@part;
		emotion ET_BEST;
		.@refinecnt = .@refinecnt - 1;
		.@refinerycnt = getequiprefinerycnt(.@part);
		next;
	}
	mes "["+ .@npc_name$ +"]";
	mes "ñS€æÙóôğäõ¡@ôeÉÙÎ]¡@¡@ÓQ¼c¡@¡@®ş¡@¡@îØá¦¡@.";
	close;
}

// Material Salesmen
//============================================================
prt_in,56,68,5	script	¡@¡@ÜşÅĞŠ	86,{
	callfunc "phramain","¡@¡@ÜşÅĞŠ";
	end;
}
payon,145,178,3	script	ÒZ¡@¡@ºí¨Rµj	88,{
	callfunc "phramain","ÒZ¡@¡@ºí¨Rµj";
	end;
}
morocc_in,63,32,6	script	®[÷âµj	99,{
	callfunc "phramain","®[÷âµj";
	end;
}
alberta_in,13,71,3	script	îà¢JÜöóaÁ}¡@óc¯	86,{
	callfunc "phramain","îà¢JÜöóaÁ}¡@óc¯";
	end;
}
yuno_in01,171,27,4	script	¾È²l¡@óa¼	88,{
	callfunc "phramain","¾È²l¡@óa¼";
	end;
}
ein_in01,15,87,3	script	âY¡@¡@Âï¡@¡@óc¯	86,{
	callfunc "phramain","âY¡@¡@Âï¡@¡@óc¯";
	end;
}
lhz_in02,278,24,3	script	ôe¡@Üşóh¯	86,{
	callfunc "phramain","ôe¡@Üşóh¯";
	end;
}

// Material Salesmen Functions
//============================================================
function	script	phramain	{
	if (checkweight(1201,1) == 0) {
		mes "ÒFËfÁú®şÔí¨jÅO€å¡@¿G¡@¡@®şŞN¡@¡@†,";
		mes "îÔÃ¸¡@¡@ÜÙ¡@®şÀ§Ñ«îØá¦¡@ñS¬²¡@Áí§!";
		close;
	}
	.@npc_name$ = getarg(0);
	mes "[" + .@npc_name$ + "]";
	mes "ÒF¡@¡@, îØÕoÃrôe¶!";
	mes "ñiİtğo¡@ÉÙÙóîàÑî¡@¡@ŞeİµñiÑïåÎìN¡@İµîâ¨ïéL¡@ËÃ¡@ºö¼@¡@Ãë²ë¡@îî€è¡@ôğäõìÆÅô.";
	next;
	mes "[" + .@npc_name$ + "]";
	mes "öa¡@åMíi¡@Ôøôğ¡@ÖĞŞ¶ÎØÙó:";
	mes "ºö¼@¡@µ¼ÌBÀb1Îg¡t¡@ôğ¡@d78400¼d«¡ìÙÎg¡t¡@¡@¡@¡@-ºí¡@áø®ş€^000000.";
	mes "ìL»£Ü×µ¼ÌBÀb2Îg¡t¡@ôğ¡@007777¼d«¡ìÙÎg¡t¡@¡@¡@¡@-ºí¡@áø¡@¡@000000.";
	mes "æ¢²lÙ·ÒF¡@¡@·åËµ³İ¯KªO¡@¿¨?";
	next;
	switch(select("¼d«¡ìÙÎg¡t¡@¡@¡@¡@-ºí¡@áø®ş€ - ^f56925200 ¡@¡@¡@^000000:¼d«¡ìÙÎg¡t¡@¡@¡@¡@-ºí¡@áø¡@Œ - ^f569251000 ¡@¡@¡@^000000:æ¢¡@Ù·îã¦·¡@¡@¡@¡@")) {
	case 1:
		.@material = 1010;
		.@price = 200;
		break;
	case 2:
		.@material = 1011;
		.@price = 1000;
		break;
	case 3:
		mes "[" + .@npc_name$ + "]";
		mes "îã¦·¡@¡@¡@¡@?";
		mes "ÒF¡@ÚV·å¨ŞÃ¯ôï¦l¯\µ¼ÌBÀbôğ¡@¡@îé¨?";
		mes "ñi¡@¡@ìHåıÎæ²ØÏ²¡@¡@¡@¡@óq¡@¡@îò¬²ÂSîâ§êÕÚ¡@¦...";
		close;
	}
	mes "[" + .@npc_name$ + "]";
	mes "ÒF¡@¡@·åËµ³İ¯KªO¡@ø¯¡@°y?";
	mes "ÀáØQõ×ÒF¡@ÓGîÏÃd³İ¯K°, æ¢ºÆ¡@îã¡@áøÃs— 0 îà¨R¡@.";
	next;
	while(1) {
		input .@input;
		if (.@input <= 0) {
			mes "[" + .@npc_name$ + "]";
			mes "¾ü¬ÉÕÚ, Ãì¡@¡@¡@¡@¡@, ®fÓ³Úêºı¡@æU.";
			close;
		}
		else if (.@input < 0 || .@input > 500) {
			mes "[" + .@npc_name$ + "]";
			mes "¾ü¬ÉÕÚ, îÕ¦....?";
			mes "ÒF¡@ÓGîí¡@¤¬®ş€æ¡@íi¡@«ıÅĞÎIÁ^ 500 ®şª, OK?";
			next;
		}
		else {
			break;
		}
	}
	.@sell = .@input * .@price;
	if (Zeny < .@sell) {
		mes "[" + .@npc_name$ + "]";
		mes "ôe¡@¡@ô\³}ÓGÂz®páÜ.";
		mes "ÒFÊD¡@¡@£¸ÕÚ¡@¡@¡@®şá¬­áÒW¡@³İ¯K©Õğo¡@ÒXÖĞŞ¶«±¡@.";
		mes "âYø¬éFîí¡@ÓGæ¦ºqÚÓÚ¬İlÕÚ.";
		mes ""+ .@input +" of them.";
		close;
	}
	if (checkweight(.@material,.@input) == 0) {
		mes "[" + .@npc_name$ + "]";
		mes "¾È¡@ÎqÎg‰!";
		mes "Âí£¸ÕÚíiêU¾·Ãë¡@¡@íi¡@«ı¾[¢ì¡@¿G²BÖĞŞ¶¿.";
		mes "æ¢¾W¡@¡@ÜÙ¡@®şìÎèöîÑ¡@Ñ«îØá¦¡@Áí§.";
		close;
	}
	getitem .@material,.@input;
	Zeny = Zeny-.@sell;
	mes "[" + .@npc_name$ + "]";
	mes "¾üÂÇåÍ, âYÅÏåÎÒFËf¡@ôğ¡@ÖĞŞ¶¿, ºı¡@¡@!";
	mes "Áò¡@¤÷Âï¡@ªüÒFÊDÕÚîã¡@¡i.";
	close;
}

// Ori/Elu Refiners
//============================================================
prt_in,63,69,3	script	Ú¬éïìÍ¡@ìÎ¡@	84,{
	callfunc "orimain","Ú¬éïìÍ¡@ìÎ¡@";
	end;
}
payon,137,178,5	script	¿G¡@ìÆ	88,{
	callfunc "orimain","¿G¡@ìÆ";
	end;
}
morocc_in,72,32,6	script	¡@´ã®`ñV‰	99,{
	callfunc "orimain","¡@´ã®`ñV‰";
	end;
}
alberta_in,21,63,5	script	¡@ÂE¡@¡@®	84,{
	callfunc "orimain","¡@ÂE¡@¡@®";
	end;
}
yuno_in01,164,27,4	script	¾È²l¡@ÒZŠ	88,{
	callfunc "orimain","¾È²l¡@ÒZŠ";
	end;
}
ein_in01,18,82,6	script	İÒ¡@Öİ²N¡@¡@Áï³	84,{
	callfunc "orimain","İÒ¡@Öİ²N¡@¡@Áï³";
	end;
}
lhz_in02,281,24,5	script	ùÁ¢F¡@²Z	84,{
	callfunc "orimain","ùÁ¢F¡@²Z";
	end;
}

// Ori/Elu Functions
//============================================================
function	script	orimain	{
	if (checkweight(1201,1) == 0) {
		mes "ÒFËfÁú®şÔí¨jÅO€å¡@¿G¡@¡@®şŞN¡@¡@†,";
		mes "îÔÃ¸¡@¡@ÜÙ¡@®şÀ§Ñ«îØá¦¡@ñS¬²¡@Áí§!";
		close;
	}
	.@npc_name$ = getarg(0);
	mes "[" + .@npc_name$ + "]";
	mes "ÒF¡@¡@, îØÕoÃrôe¶!";
	mes "îí¡@¡@ÒF¡@¡@^FF0000²ØÏ²¡@¡@¡@¡@îÔ¡@¡@^000000ñiÉñFF0000ìHåı®v¡@¯£000000ñVÎØ¡@.";
	mes "ñi¡@¡@®şÔí®òîí¡@¤¬®şÅF¡@¡@İl¡@^0000ff²ØÏ²¡@¡@¡@¡@^000000îÕ¡@0000ffìH¡@000000.";
	mes "ÒF¡@åÎæ¦¹{¡@, î¿Ëæ¡z·åËÁÙó 5 ®ş¡@®v¡@ÄwÓQ";
	mes "ñi¡@åMÃì¡@¡@®\òK©²ÒF¡@¡@ôï¼.";
	next;
	switch(select("ñi¡@¡@·åËÃ¡@ÒF¡@0000ff ²ØÏ²¡@¡@¡@¡@ ^000000!:æ¢®p©²ñi¡@¡@ôï·Îññ®ş€åæT^ff0000 ìH ^000000!:æ¢¡@Ù·îã¥Rò«ÅôÏ´€§¡@¸ó¡@...")) {
	case 1:
		if (countitem(756) > 4) {
			delitem 756,5;  //Oridecon_Stone
			getitem 984,1; // Oridecon
			mes "[" + .@npc_name$ + "]";
			mes "âYÅÏåÎñi¡@¡@ø¯ÂÇ¡@ËC¡@¡@ôï·Îññ¡@¡@ÕÚ²ØÏ²¡@¡@¡@¡@.";
			mes "¼c¡@¡@ÒF¡@ÓB¼c¡@Ô©¡@¥.";
			close;
		}
		else {
			mes "[" + .@npc_name$ + "]";
			mes "¡@³ú¡@¡@ˆ...ÒFÊDÚBôø¤ËÓR¡@¡@âÓ.";
			mes "ñi¡@ÓGóq¡@¡@ÒFËf¡@âY‡, ·åËÁåÎ®[¢JÙó5®ş¡@¡@¯KìÖìÆÅô¡@®v¡@±RÕÚæ¢, óq¡@Ù¶®\òK¡@ÒF·À¡@¯KìÖìÆÅôÏµÕÚÁí—?";
			close;
		}
	case 2:
		if (countitem(757) > 4) {
			delitem 757,5;  //Elunium_Stone
			getitem 985,1; // Elunium
			mes "[" + .@npc_name$ + "]";
			mes "âYÅÏåÎñi¡@¡@ø¯ÂÇ¡@ËC¡@¡@ôï·Îññ¡@¡@ÕÚìH.";
			mes "¼c¡@¡@ÒF¡@ÓB¼c¡@Ô©¡@¡@€‚";
			close;
		}
		else {
			mes "[" + .@npc_name$ + "]";
			mes "¡@³ú¡@¡@ˆ...ÒFÊDÚBôø¤ËÓR¡@¡@âÓ.";
			mes "ñi¡@ÓGóq¡@¡@ÒFËf¡@âY‡, ·åËÁåÎ®[¢JÙó5®ş¡@ºQîÔ¡@¡@ôğ¡@ên, óq¡@Ù¶®\òK¡@ÒFŞEºQôğáD¡@?";
			close;
		}
	case 3:
		mes "[" + .@npc_name$ + "]";
		mes "îã¥Rò«ÅôÏ´€§¡@¸ó¡@...";
		mes "ñi¡@¡@ìL»£Ü×¡@¡@¡@âY÷á¡@®fÓ³ÚêÁç²BÂ²¡@¡@¡@ÄÊ´, Áí¡@Á^¾È³ú¡@âY÷à³Qîâ¡@ÕÚÒZËf¡@...";
		mes "ÒF¶ãÂµ®[¡@ís¡@ÎI¡@âYÊ¨é¡!";
		next;
		mes "[" + .@npc_name$ + "]";
		mes "ñi¡@Øøæ¢¼¼ìÆÅô¬°¡@Áí¡@ï»ñV¡@Ùó®ş€ä¡@ºğ¿Ğ§Ş";
		mes "«¹²f€¡@¯ë€ôë¡@€ÙÊÎ¹¡@ÅôÏ´€§.";
		next;
		mes "[" + .@npc_name$ + "]";
		mes "¡@£º¡@îØ²ë¡@îé£·¡@Áî¡@¡@ÅôÏ´€§Ãë¨ïÕÚæ¢...";
		mes "ñS€å¡@ÒFŞ[ññ¡@¡@ÕÚÎg¡t¡@, ø¯¡@átÃì¡@Ô\ÅôÏ´€§¡@¸ó¡@ôğ¡@¡@¼d«¡ÌF¡@.";
		next;
		mes "[" + .@npc_name$ + "]";
		mes "¡@³ú¡@..®şá¬Á^æ¢éô¡@ÁæÏ´¡@, ";
		mes "ùVÂÇ¡@îÙÂEğo¿¨á¦¡@îé£¸ÕÚ¡@¯M¡@î¿Ëå¡@ôe¡@átÃì¡@¡@İÓé×ÕÚìL»£Ü×¡@€æÙõ.";
		close;
	}
}

// Equipment Repairmen
//============================================================
alberta_in,31,65,4	script	²N¡@ÕQ®f¥#alb	86,{
	callfunc "repairmain","²N¡@ÕQ®f¥";
	end;
}

moc_ruins,107,94,4	script	²N¡@ÕQ®f¥#moc	99,{
	callfunc "repairmain","²N¡@ÕQ®f¥";
	end;
}

payon,143,165,4	script	²N¡@ÕQ®f¥#pay	88,{
	callfunc "repairmain","²N¡@ÕQ®f¥";
	end;
}

prt_in,63,54,2	script	²N¡@ÕQ®f¥#prt	86,{
	callfunc "repairmain","²N¡@ÕQ®f¥";
	end;
}

yuno_in01,175,28,3	script	²N¡@ÕQ®f¥#juno	86,{
	callfunc "repairmain","²N¡@ÕQ®f¥";
	end;
}

geffen_in,34,166,3	script	²N¡@ÕQ®f¥#gef	99,{
	callfunc "repairmain","²N¡@ÕQ®f¥";
	end;
}

aldeba_in,38,60,3	script	²N¡@ÕQ®f¥#alde	86,{
	callfunc "repairmain","²N¡@ÕQ®f¥";
	end;
}

lhz_in02,284,14,3	script	²N¡@ÕQ®f¥#lhz	86,{
	callfunc "repairmain","²N¡@ÕQ®f¥";
	end;
}

prt_gld,139,117,4	script	²N¡@ÕQ®f¥#prt_gld	86,{
	callfunc "repairmain","²N¡@ÕQ®f¥";
	end;
}

gef_fild13,263,117,4	script	²N¡@ÕQ®f¥#gef_fild	86,{
	callfunc "repairmain","²N¡@ÕQ®f¥";
	end;
}

pay_gld,295,183,4	script	²N¡@ÕQ®f¥#pay_gld	86,{
	callfunc "repairmain","²N¡@ÕQ®f¥";
	end;
}

alde_gld,220,152,4	script	²N¡@ÕQ®f¥#alde_gld	86,{
	callfunc "repairmain","²N¡@ÕQ®f¥";
	end;
}

aru_gld,189,336,4	script	²N¡@ÕQ®f¥#aru_gld	86,{
	callfunc "repairmain","²N¡@ÕQ®f¥";
	end;
}

sch_gld,340,80,7	script	²N¡@ÕQ®f¥#sch_gld	86,{
	callfunc "repairmain","²N¡@ÕQ®f¥";
	end;
}

// Equipment Repair Function
//============================================================
function	script	repairmain	{
	.@repairprice = 5000;
	.@npc_name$ = getarg(0);
	mes "["+.@npc_name$+"]";
	mes "ÒF¡@¡@, îØÕoÃrôe¶!";
	mes "ÒF¡@¡@æ¦ùó¡@²N¡@ÕQ®şŞN¡@Áí—?";
	next;
	mes "["+.@npc_name$+"]";
	mes "ñi¡@¡@ÒW¡@©²ÒF¡@´n¡@¡@¡@¡@ÌBÕÚ·è¡@¡@îíÔİ¡@îé¨!";
	next;
	switch(select("¡@©...Ãì¡@ÖĞŞ¶¦j´n...:öa¡@åM®[¢JÙó·åË¼´n¡@ÜßÕÚ®şŞN¡@...")) {
	case 1:
		.@checkitem = 1;
		while (1) {
			if (getbrokenid(.@checkitem) == 0) {
				break;
			}
			.@checkitem = .@checkitem+1;
		}
		.@checkitem = .@checkitem-1;
		if (!.@checkitem) {
			mes "["+.@npc_name$+"]";
			mes "îé¢! âY÷àÚBóq¡@ÑıÒW¡@Ã¦²N¡.";
			mes "ÒFËfÔfôeÉ¡æ`Ú¬½Z¡@î¿¡@¡@ôğ¡@éL¡@! ®[¢JÙóÒW¿ĞßZ¡@¡@¡@¡@¡@";
			next;
			mes "["+.@npc_name$+"]";
			mes "ÀáØQõ×«»¡@°y¡@¬x¡@Áá¡@¡@âYÅÏ¡@ôø¿ë¡@¡@¡@İµôğ¡@ên, ñi¡@®òÒZºr¡@¿GÅÜ¡@¡@†!";
			close;
		}
		mes "["+.@npc_name$+"]";
		mes "Áëƒ... æ¦ùó¡@öfìÒÙï...";
		mes "ÒF¡@¡@îã¿ëÙó ^ff0000" + .@checkitem + "^000000 ÒW¨ïéL¡@ËÁ¡@îê¡@Â².";
		mes "îÏ¥R´n¡@ÜÙ¡@ÒW¡@¡@?";
		next;
		.@totalcost = .@repairprice*.@checkitem;
		mes "["+.@npc_name$+"]";
		mes "²N¡@ÕQ®ş€äÅwîî€è¡@ " + .@repairprice + " ¡@¡@¡@.";
		mes "îÏ¥R´n¾üÂÇ¡@è¨£¸éL¡@Ë¶ÚV·å " + .@totalcost + " ¡@¡@¡@!";
		mes "ÒF¡@¡@²N¡@ÕQÒWÑî·ÆÁí—?";
		next;
		switch(select("óq¡@ÕÚ, Ú¬¡@¡@¡@Ôí¡@ÒW¡@¡@²N¡@ÕQ¡@¡@¡@.:ßX¡@Â², ¡@ØQ¡@®ş¹ñ´n¡@ÜÙÂ²...")) {
		case 1:
			if (Zeny < .@totalcost) {
				mes "["+.@npc_name$+"]";
				mes "Áë¡@¡@..";
				mes "ÒFÊDÕÚ¡@¡@Ñ·®şá¬­áÒW¡@¡@ÒWé×²a²N¡@««¡@£¶¡@.";
				mes "îÙ¡@¡@ìN¤ËÔ©¡@¡@ÂSñi¡@¡@.";
				close;
			}
			.@checkitem2 = 1;
			while (1) {
				if (getbrokenid(.@checkitem2) == 0) {
					break;
				}
				.@checkitem2 = .@checkitem2+1;
			}
			.@checkitem2 = .@checkitem2-1;
			if (.@checkitem == .@checkitem2) {
				Zeny = Zeny-.@totalcost;
				while (.@checkitem) {
					repair(.@checkitem);
					.@checkitem = .@checkitem-1;
				}
				mes "["+.@npc_name$+"]";
				mes "Ok! îã£º¡@Ú¬¡@¡@²N¡@¡@¡@†.";
				close;
			}
			else {
				mes "["+.@npc_name$+"]";
				mes "öf¡@¡@ÒF¡@­e®[¢JÙóÒW¿ĞßZîêÉá¡@ôğ¡@ÖĞŞ¶¶ôÚV·åË¼´n¡@¡@å§...";
				close;
			}
		case 2:
			mes "["+.@npc_name$+"]";
			mes "ós´k««öf¡@ÕÚ®ş¹ò¡@íiµ,";
			mes "ôe¡@¡@ÒF¡@ÑOÂzªO¡@...";
			mes "ñiİt¡@Ú¬¡@¡@²N¡@ÕQîêÉá¡@ôğ¡@¡@¿GÊ¨±jÎg¡t¡@!";
			close;
		}
	case 2:
		mes "["+.@npc_name$+"]";
		mes "¡@¦, ¾ü¬ÉÕÚ.";
		mes "µ¼¡@¡@îî€è¡@²N¡@ÕQ¡@¡@İµôğ¡@ên,";
		mes "îí¡@¤¬¡@¡@ÂSñi‘.";
		close;
	}
}

//============================================================ 
// Old changelog
//============================================================ 
//= 1.0 by A bunch of people!
//=     Syrus22 - Completely redid the script using functions... also
//=     added the option for auto safe refining and multiple refining.
//= 1.1 Negative input bug fixed [Lupus]
//= 1.2 Added additional reparimen in Morocc and payon. Added
//=     Christopher the blacksmith in Geffen. Edited some dialogue [kobra_k88]
//= 1.3 New Payon Locations [Darkchild]
//=     Corrected zeny subtraction thx to jpnmania77.[kobra_k88]
//= 1.3a Temporary corrected an exploit. Need to check sources
//=     to fully fix bug [Shinigami]
//=     Fixed repairman prices [shadowlady]
//=     Fixed bug that skips requirements thanks to sir_loon [massdriller]
//=     Fixed itemid error thanks to -Vitamin- [massdriller]
//= 1.4 check again item in refining procedure to avoid
//=     hacker that can change item [dafide18]
//= 1.5 Fixed crashing due to badly used callfunc's [Skotlex]
//=     Lupus, don't rollback this important fix again! >.<
//= 1.5a Corrected an unneeded callfunc, fixed the anti-bot 
//=     exploit ruining the safe refine loop. [Skotlex]
//= 1.5b Fixed Spelling mistakes. [Nexon] 
//= 1.6 Replaced all breaks for ends as per the new script engine [Skotlex]
//= 1.7 Added Einbroch Refiners (Custom names ^^;) and a duplicated BS Shop. [Poki#3]
//= 1.8 Added Lighthalzen Refiners (Custom names again ^^;) [Poki#3]
//= 1.8a Fixed wrong indication thanks to NeoSaro [Lupus]
//= 1.9 Rewrote repairman, removed the Steel from repair cost [DracoRPG]
//= 2.0 Fixed missed equppment presence check. Thx2 Coltaro [Lupus]
//= 2.0a Added weight checks thanks to Neouni [Playtester]
//= 2.0b Fixed the names of Lighthalzen and Einbroch refiners thanks to Maud_Dib [Kargha]
//= 2.1 Removed Duplicates [Silent]
//= 2.2 Changed name from "Emvertacon" to "Emveretarcon". [Samuray22]
//=     Thanks to Barron-Monster.
//= 2.2b Changed name from "Pharacon" to "Phracon". [Samuray22]
//=     Thanks to Barron-Monster.
//= 2.3 Corrected NPC names to fall within proper restrictions. [L0ne_W0lf]
//= 2.4 Updated Refiner function. cleaner, and less dated. [L0ne_w0lf]
//= 2.5 Rather large update to the refiner and merchants. :D [L0ne_W0lf]
//= 2.6 Fixed a few bugs with creating pure stones. [L0ne_W0lf]
//= 2.7 Refiner function accepts additional paramater. [L0ne_W0lf]
//=     0 = No special features; 1 = new refining features
//=     Updated Repairmen and function. No longer shows menu.
//= 2.7a A couple touch-ups to the repairman function. [L0ne_w0lf]
//= 2.8 Changed the nonexistent variable .@matname$ for getitemname(.@material). (bugreport:2340) [Samuray22]
//= 2.8 Added proper Blacksmith Supplier to Einroch. [L0ne_W0lf]
//=     Updated dated features comment to reflect new usage.
//= 2.8a Small bugfix. (bugreport:2418) [Paradox924X]
//= 2.9 Moved Morocc repairman to Morocc Ruins. [L0ne_W0lf]
//============================================================
